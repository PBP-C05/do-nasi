{% extends 'base.html' %}

{% block meta %}
<title>Harapan Donatur</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
    integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
    integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
    integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.6/js/bootstrap.min.js"
    integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
    crossorigin="anonymous"></script>
<link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Inknut Antiqua' rel='stylesheet'>


<style>
    main {
        font-family: 'Poppins';
    }

    .carousel-caption {
        top: 32%;
    }

    .card,
    h1 {
        margin: 40px;
    }


    .card:hover {
        transform: scale(1.01);
        box-shadow: 0 10px 20px rgba(0, 0, 0, .12), 0 4px 8px rgba(0, 0, 0, .06);
    }

    .carousel-inner {
        height: 400px;
    }
</style>
{% endblock meta %}


{% block content %}
<main>
    <div>
        <!-- Carousel -->
        <div id="harapan-carousel" class="carousel slide" data-bs-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#harapan-carousel" data-slide-to="0" class="active"></li>
                <li data-target="#harapan-carousel" data-slide-to="1"></li>
                <li data-target="#harapan-carousel" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="https://www.london.ac.uk/sites/default/files/styles/max_1300x1300/public/2018-07/nelson-lc-mandela-day.jpg?itok=gPOR6fdZ"
                        class="d-block w-100" alt="Second Slide">
                    <div class="carousel-caption d-none d-md-block">
                        <h3>Nelson Mandela</h3>
                        <h6>“Overcoming poverty is not a task of charity, it is an act of justice.”</h6>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="https://blue.kumparan.com/image/upload/fl_progressive,fl_lossy,c_fill,q_auto:best,w_640/v1557392586/gbsflphemfgavkf4y3il.jpg"
                        class="d-block w-100" alt="First Slide">
                    <div class="carousel-caption d-none d-md-block">
                        <h3>Mahatma Gandhi</h3>
                        <h6>“Life as if you were to die tomorrow. Learn as if you were life forever.”</h6>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="https://cdn-2.tstatic.net/manado/foto/bank/images/mendiang-munir-said-thalib-aktivis-indonesia323453.jpg"
                        class="d-block w-100" alt="Third Slide">
                    <div class="carousel-caption d-none d-md-block">
                        <h3>Munir Said Thalib</h3>
                        <h6>“Setiap orang yang dilahirkan merdeka, memiliki hak dan martabat yang sama.”</h6>
                    </div>
                </div>
            </div>
            <a class="carousel-control-prev" role="button" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" role="button" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>

        </div>

        <!-- Opening -->
        <div>
            {% if request.user.is_authenticated %}
            {% if user.role == "Donatur" %}
            <h1 class="text-center font-weight-bold">
                Apakah anda tertarik mengisi harapan ?
            </h1>
            <div class="d-flex justify-content-center mb-5">
                <button id="tambah-btn" type="button" class="btn btn-outline-warning btn-rounded"
                    data-mdb-ripple-color="dark" data-toggle="modal" data-target="#modalAddHarapan">
                    Tambah Harapan
                </button>
            </div>
            {% else %}
            <h1 class="text-center font-weight-bold">
                Pesan dari Donatur kami...
            </h1>
            {% endif %}
            {% endif %}
        </div>

        <!-- Harapan Card -->
        <div id="harapan-data"></div>

        <!-- Modal -->
        <div class="modal fade" id="modalAddHarapan" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenter"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <!--Modal Header-->
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel">Tambahkan harapan anda, {{user.username}} !</h3>
                    </div>
                    <div>
                        <h6 class="modal-title text-danger font-weight-bold text-center" id="alert-text"></h6>
                    </div>
                    <!--Modal Body-->

                    <div class="modal-body">
                        <form method="POST" action="" id="add-harapan-form">
                            {% csrf_token %}
                            <div class="form-outline mb-10">
                                <textarea id='text-handler' type="text" rows="10" class="form-control" name="text-area"
                                    placeholder="Semoga bermanfaat bagi lingkungan sekitar..." required></textarea>
                            </div>
                        </form>
                    </div>

                    <!--Modal Footer-->
                    <div class="modal-footer">
                        <button type="button" data-dismiss="modal" class="btn btn-outline-danger">Close</button>
                        <button id="save-harapan" type="submit" class="btn btn-outline-success">Simpan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>

    $(function () {
        $('#harapan-carousel').carousel();
    });

    $('.carousel-control-prev').click(function () {
        $('#harapan-carousel').carousel('prev');
    });

    $('.carousel-control-next').click(function () {
        $('#harapan-carousel').carousel('next');
    });


    const textarea = document.getElementById('text-handler');
    const alert_text = document.getElementById('alert-text');

    function createHarapan() {
        if ($('#text-handler').val() != "") {
            $.post({
                url: 'add-harapan/',
                type: 'post',
                data: {
                    'text': $('#text-handler').val(),
                },
                success: harapanShow,
            })
            textarea.value = ''
            alert_text.value = ''
        }
    }

    $('#save-harapan').click(function () {
        if ($('#text-handler').val() != "") {
            createHarapan();
            $('#modalAddHarapan').modal('toggle');
            $("#alert-text").text("");
        } else {
            $("#alert-text").text("Harapan anda masih kosong !");
        }
    });

    $('#tambah-btn').click(function () {
        console.log('ABC');
        $('#modalAddHarapan').modal('toggle');
        $("#alert-text").text("");
        textarea.value = ''
    });

    function harapanShow() {
        $('#harapan-data').empty();
        $.getJSON("./show-json", function (result) {
            for (let i = 0; i < result.length; i++) {
                console.log(result[i].fields.email);
                $('#harapan-data').append(
                    `<div class="card">
                        <div class="card-body">
                            <div class="d-flex gap-3 flex-row">
                                <h5 class="card-title font-weight-bold">${result[i].fields.username}</h5>
                                <p class="card-text mx-3"><small class="text-muted">${result[i].fields.email}</small></p>
                            </div>
                            
                            <p class="card-text">${result[i].fields.text}</p>
                            <p class="card-text"><small class="text-muted">${result[i].fields.created_at}</small></p>
                        </div>
                    </div>`
                )
            }
        });
    }

    harapanShow();

</script>

{% endblock content %}